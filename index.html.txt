<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- تم تعديل اسم التطبيق في العنوان -->
    <title id="app-title">تطبيق حوّلها تليكوم | Hawelha Telecom</title>
    
    <!-- تحميل Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* خط عربي محسن */
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap');
        body {
            font-family: 'Cairo', sans-serif;
            background-color: #f7f9fc;
            min-height: 100vh;
        }
        .main-container {
            max-width: 420px; /* محاكاة عرض شاشة الموبايل */
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        .file-input-label {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .file-input-label:hover {
            background-color: #059669; /* لون أخضر داكن عند التحويم */
            border-color: #047857; /* حدود أغمق عند التحويم */
            box-shadow: 0 4px 15px rgba(5, 150, 105, 0.4);
        }
        /* تعديل لون خلفية مربع اختيار الملف */
        .file-input-label {
            background-color: #ecfdf5; /* أخضر فاتح جداً */
            border-color: #34d399; /* أخضر متوسط */
            color: #065f46; /* أخضر داكن للنص */
        }
        .shadow-soft {
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        /* حجم مخصص للشعار (72 بكسل) */
        .logo-size {
            width: 72px;
            height: 72px;
        }
    </style>
</head>
<body class="flex items-center justify-center p-4">

<div id="app" class="main-container w-full bg-white rounded-xl overflow-hidden">

    <!-- شريط العنوان - باللون الأخضر -->
    <header class="bg-green-600 p-5 text-white text-center rounded-t-xl">
        <div class="flex items-center justify-center space-x-4 space-x-reverse">
            <!-- سيتم تحميل الرابط الجديد من الجافاسكريبت -->
            <img id="app-logo" src="" alt="شعار حوّلها تليكوم" class="logo-size rounded-lg object-contain">
            <div>
                <!-- تم تغيير الاسم المعروض -->
                <h1 class="text-3xl font-bold" id="app-name-display">Hawelha Telecom | حوّلها تليكوم</h1>
                <p class="text-base opacity-90 mt-1">مُحوّل فواتير PDF الذكي</p>
            </div>
        </div>
    </header>

    <!-- المحتوى الرئيسي -->
    <main class="p-6 space-y-8">
        <!-- قسم رفع الملف -->
        <section class="space-y-4">
            <h2 class="text-lg font-semibold text-gray-700 border-b pb-2 mb-4">الخطوة 1: رفع ملف PDF النظيف</h2>
            
            <label for="pdf-upload" class="file-input-label flex flex-col items-center justify-center p-6 border-2 border-dashed text-green-700 rounded-lg">
                <svg class="w-8 h-8 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path></svg>
                <span id="file-name" class="font-medium text-sm">اضغط هنا لاختيار ملف فاتورة PDF</span>
            </label>
            <input type="file" id="pdf-upload" accept=".pdf" class="hidden" onchange="displayFileName(event)">
        </section>

        <!-- قسم الأعمدة المطلوبة -->
        <section class="space-y-4">
            <h2 class="text-lg font-semibold text-gray-700 border-b pb-2">الخطوة 2: الأعمدة المستهدفة (من اليمين لليسار)</h2>
            <div class="bg-gray-50 p-4 rounded-lg shadow-soft text-sm">
                <p class="font-bold text-green-700 mb-2">سيتم استخراج وترتيب الأعمدة كالتالي:</p>
                <ul class="list-disc list-inside space-y-1 text-gray-600 grid grid-cols-2 gap-x-4">
                    <li>الرقم</li>
                    <li>الرسوم الشهرية</li>
                    <li>المكالمات المحلية</li>
                    <li>الرسائل المحلية</li>
                    <li>انترنت محلي</li>
                    <li>مكالمات دولية</li>
                    <li>رسائل دولية</li>
                    <li>انترنت تجوال</li>
                    <li>رسوم التسوية</li>
                    <li>قيمة الضرائب</li>
                    <li>الاجمالي</li>
                </ul>
            </div>
        </section>

        <!-- زر التحويل -->
        <button id="convert-button" onclick="handleConversion()" disabled class="w-full py-3 bg-gray-400 text-white font-bold rounded-lg transition duration-300 ease-in-out cursor-not-allowed">
            التحويل والتنزيل (يُرجى رفع ملف أولاً)
        </button>

        <!-- رسالة الحالة (للتنبيهات) -->
        <div id="message-box" class="hidden p-3 rounded-lg text-sm text-center"></div>

    </main>
    
    <!-- الفوتر باسم Hawelha Telecom -->
    <footer class="text-center text-sm p-3 text-gray-500 border-t">
        <p>تم التصميم بواسطة <span id="footer-credit" class="font-bold">Hawelha Telecom</span> لغرض الاستخدام الخاص بالشركة.</p>
    </footer>

</div>

<script>
    // ** التعديل الجديد لتصحيح الرابط الخام مع الامتداد المزدوج **
    const APP_DISPLAY_NAME = "Hawelha Telecom | حوّلها تليكوم"; 
    // استخدام الرابط الخام لاسم الملف الذي ينتهي بـ .png.jpg
    const APP_LOGO_URL = "https://raw.githubusercontent.com/najat2030/Hawelha/main/hawelha_logo.png.jpg"; 
    const FOOTER_NAME = "Hawelha Telecom"; 
    // ======================

    document.getElementById('app-title').textContent = APP_DISPLAY_NAME;
    document.getElementById('app-name-display').textContent = APP_DISPLAY_NAME;
    document.getElementById('app-logo').src = APP_LOGO_URL;
    // إضافة معالج خطأ في حالة عدم تحميل الصورة
    document.getElementById('app-logo').onerror = function() {
        this.onerror=null;
        // استخدام صورة بديلة/مكان حجز في حالة فشل التحميل
        this.src='https://placehold.co/72x72/8dc63f/ffffff?text=LOGO'; 
    };
    document.getElementById('footer-credit').textContent = FOOTER_NAME;
    document.getElementById('footer-credit').classList.add('font-bold'); 

    const convertButton = document.getElementById('convert-button');
    const fileNameDisplay = document.getElementById('file-name');
    const messageBox = document.getElementById('message-box');
    let selectedFile = null;

    // تم تحديث الأعمدة لتتناسب مع القائمة المعروضة في HTML
    const COLUMN_HEADERS = [
        "الرقم", "الرسوم الشهرية", "المكالمات المحلية", "الرسائل المحلية", "انترنت محلي", 
        "مكالمات دولية", "رسائل دولية", "انترنت تجوال", "رسوم التسوية", "قيمة الضرائب", "الاجمالي"
    ];
    
    const MOCK_EXTRACTED_DATA = [
        {
            "الرقم": "٠١٠٠٢٧٧٩٨٧٤", "الرسوم الشهرية": 44.50, "المكالمات المحلية": 12.00,
            "الرسائل المحلية": 0.00, "انترنت محلي": 20.00, "مكالمات دولية": 5.00,
            "رسائل دولية": 0.00, "انترنت تجوال": 0.00, "رسوم التسوية": 0.00, "قيمة الضرائب": 6.70,
            "الاجمالي": 52.20
        },
        {
            "الرقم": "٠١٠٠٣٧٧٧٧٥٠", "الرسوم الشهرية": 30.00, "المكالمات المحلية": 8.50,
            "الرسائل المحلية": 0.00, "انترنت محلي": 15.00, "مكالمات دولية": 0.00,
            "رسائل دولية": 0.00, "انترنت تجوال": 0.00, "رسوم التسوية": 2.50, "قيمة الضرائب": 5.48,
            "الاجمالي": 40.85
        },
        {
            "الرقم": "٠١٠٠٢٥٩١٥٥٥", "الرسوم الشهرية": 60.00, "المكالمات المحلية": 25.00,
            "الرسائل المحلية": 1.00, "انترنت محلي": 30.00, "مكالمات دولية": 10.00,
            "رسائل دولية": 0.00, "انترنت تجوال": 0.00, "رسوم التسوية": 0.00, "قيمة الضرائب": 15.00,
            "الاجمالي": 78.58
        }
    ];

    function displayFileName(event) {
        const file = event.target.files[0];
        if (file) {
            selectedFile = file;
            fileNameDisplay.textContent = تم اختيار: ${file.name};
            convertButton.disabled = false;
            convertButton.classList.remove('bg-gray-400', 'cursor-not-allowed');
            convertButton.classList.add('bg-green-600', 'hover:bg-green-700', 'cursor-pointer');
            showMessage(ملف ${file.name} جاهز للتحويل., 'success');
        } else {
            selectedFile = null;
            fileNameDisplay.textContent = 'اضغط هنا لاختيار ملف فاتورة PDF';
            convertButton.disabled = true;
            convertButton.classList.add('bg-gray-400', 'cursor-not-allowed');
            convertButton.classList.remove('bg-green-600', 'hover:bg-green-700', 'cursor-pointer');
        }
    }

    function handleConversion() {
        if (!selectedFile) {
            showMessage("يجب اختيار ملف PDF أولاً.", 'error');
            return;
        }

        convertButton.disabled = true;
        convertButton.textContent = "جاري معالجة البيانات...";
        showMessage("جاري قراءة واستخراج البيانات من PDF... (محاكاة)", 'info');

        setTimeout(() => {
            const dataToExport = MOCK_EXTRACTED_DATA;
            if (dataToExport.length === 0) {
                showMessage("لم يتم العثور على أي بيانات لاستخراجها.", 'error');
                resetButton();
                return;
            }

            const csvContent = generateCSV(dataToExport, COLUMN_HEADERS);
            downloadFile(csvContent, 'تقرير_فواتير_مستخرج.csv', 'text/csv;charset=utf-8;');

            showMessage("تم بنجاح! تم تنزيل ملف Excel (CSV) على جهازك.", 'success');
            resetButton();

        }, 3000); 
    }

    function resetButton() {
        convertButton.disabled = false;
        convertButton.textContent = "التحويل والتنزيل";
        if (selectedFile) {
             convertButton.classList.add('bg-green-600', 'hover:bg-green-700', 'cursor-pointer');
             convertButton.classList.remove('bg-gray-400', 'cursor-not-allowed');
        } else {
             convertButton.classList.add('bg-gray-400', 'cursor-not-allowed');
             convertButton.classList.remove('bg-green-600', 'hover:bg-green-700', 'cursor-pointer');
        }
    }

    function showMessage(message, type) {
        messageBox.textContent = message;
        messageBox.classList.remove('hidden', 'bg-red-100', 'text-red-700', 'bg-green-100', 'text-green-700', 'bg-blue-100', 'text-blue-700');
        
        if (type === 'success') {
            messageBox.classList.add('bg-green-100', 'text-green-700');
        } else if (type === 'error') {
            messageBox.classList.add('bg-red-100', 'text-red-700');
        } else {
            messageBox.classList.add('bg-green-50', 'text-green-800'); 
        }
    }

    function generateCSV(data, headers) {
        // يتم عكس ترتيب رؤوس الأعمدة ليتناسب مع العرض من اليمين لليسار في ملف CSV
        const orderedHeaders = [...headers].reverse();
        let csv = orderedHeaders.join(',') + '\n';
        
        data.forEach(row => {
            let values = orderedHeaders.map(header => {
                let value = row[header] !== undefined ? row[header] : ''; 
                // استبدال النقطة بالفاصلة لتنسيق الأرقام في Excel
                value = String(value).replace(/\./g, ','); 
                value = "${value}";
                return value;
            });
            csv += values.join(',') + '\n';
        });
        // إضافة Byte Order Mark لدعم اللغة العربية في برامج مثل Excel
        const bom = "\uFEFF";
        return bom + csv;
    }

    function downloadFile(content, fileName, mimeType) {
        const blob = new Blob([content], { type: mimeType });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = fileName;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    }
</script>
</body>
</html>
